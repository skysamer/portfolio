# :pushpin: 도로공사 교통예보시스템 고도화 프로젝트
>도로공사 교통예보시스템 고도화 프로젝트
>

</br>





## 2. 사용 기술
#### `Back-end`
  - Java 5
  - Spring 3
  - Maven
  - MyBatis
  - Oracle 11g
#### `Front-end`
  - JQuery
  - Ajax

</br>

## 3. ERD 설계

### 3.1. 경로형 교통량 통계
<img width="768" src="https://user-images.githubusercontent.com/73572543/141744869-120cf298-b635-48bf-8111-bff4a2c8bb37.png">

- 일자별 개별차량에 대한 주행 데이터를 저장하고 있는 테이블과 본선 고속도로 노선 별 데이터를 저장하는 테이블을 매핑합니다.
- 매핑 테이블을 바탕으로 시간대 별로 특정 노선의 ic 혹은 jc 구간 별 교통량 데이터를 산출합니다.
- 구간 별 방향 데이터가 저장된 테이블을 매핑하여 구간 별 방향을 산출합니다.

### 3.2. 휴게소 분석
<img width="817" src="https://user-images.githubusercontent.com/73572543/141925165-24c1fb9c-a98d-4b43-91ea-852cce00e7a1.png">

- 일자별 개별차량에 대한 주행 데이터를 저장하고 있는 테이블과 본선 고속도로 노선 별 데이터를 저장하는 테이블을 지점별 컬럼으로 매핑합니다.
- 매핑된 전처리 테이블을 휴게소 지점별 데이터를 저장하는 테이블과 매핑합니다.
- 자체적으로 계산한 클러스터링 계수값을 휴게소 군집별로 매핑합니다.
- 휴게소 양 끝에 설치된 구간검지기 데이터를 활용하여 지점별 이용차량 주행시간, 교통량, 차량 통과시간 데이터를 산출합니다.

### 3.3. 우회도로 현황 / 분석
<img width="817" src="https://user-images.githubusercontent.com/73572543/142105642-ff59eff2-db43-4bed-8f64-e54c0c8bb3ef.png">

- 일자별 개별차량에 대한 주행 데이터를 저장하고 있는 테이블과 본선 고속도로 노선 별 데이터를 저장하는 테이블을 지점별 컬럼으로 매핑
- 개별차랑을 시간순으로 정렬하여 개별차량의 통과 경로 데이터를 구성
- 본선 고속도로를 빠져나와 TG를 통과한 차량을 모아서 1차적으로 우회차량으로 분류
- TG를 통과한 차량 중 본선 평균 속도가 80 미만인 경우에만 차량이 우회를 했을 것으로 판단하여 2차적으로 우회차량 분류
- 본선 고속도로의 TG 구간 별로 본선 이용 차량과 우회차량을 비교하여 교통량 및 우회 시간 데이터 산출
- 기존 우회차량 데이터 및 문자정보와 비교하여 우회도로 통행시간 및 속도 데이터 산출


## 4. 핵심 기능
- 본선 고속도로의 ic-ic 구간 별 교통량 데이터 표출
- 본선 고속도로를 우회하여 주행하는 개별차량에 대한 데이터 표출
- 분석 휴게소 별 개별 차량에 대한 휴게소 이용 데이터 표출

### 4.1. 전체 흐름
<img width="828" src="https://user-images.githubusercontent.com/73572543/141735287-7c5002a1-6779-4e7b-ab1f-3afe7af1e41f.png">

### 4.2. 사용자 요청

- **데이터 항목 별 조건 설정** 
  - 날짜, 노선, 구간, 방향 등 다양한 조건을 설정합니다.
  - 특정 조건에 맞는 데이터가 없을 경우 일치하는 검색결과 없다는 메시지를 띄웁니다.

- **Ajax 비동기 요청** 
  - 데이터 표 조회 버튼 클릭 시, 데이터를 표출하는 POST 요청을 비동기로 날립니다.

### 4.3. Controller

- **요청 처리** 
  - Controller에서는 요청을 화면단에서 넘어온 요청을 HttpServlet 객체로 받고, Service 계층에 조건 파라미터 값을 전달합니다.

- **응답 처리** 
  - Service 계층에서 넘어온 데이터를 MappingJacksonJsonView 객체를 활용하여 json 객체로 전달.

### 4.4. Service

- **요청 처리** 
  - HttpServletRequest 파라미터 값의 해시 키값을 추출합니다.
  - 매핑되는 value값을 문자열로 변환합니다.
  - 변환된 파라미터 값을 HashMap 객체를 생성하여 저장합니다.

- **응답 처리** 
  - DAO 객체에서 받아온 쿼리 결과값을 CaseInsensitiveMap 객체의 List객체를 생성하여 받습니다.
  - 생성된 List값을 Controller에 전달합니다.


### 4.5. DAO

- **요청 밎 응답 처리** 
  - Service에서 가져온 파라미터 값을 Map 객체로 쿼리에 던집니다
  - SqlSession 객체를 주입하여 쿼리 결과값을 가져옵니다.
  - 저장된 데이터는 다시 Repository - Service - Controller를 거쳐 화면단에 송출됩니다.

</div>
</details>

</br>

## 5. 핵심 트러블 슈팅
### 5.1. 쿼리 성능 개선 문제
- 일자별 개별차량 데이터 수가 약 3~5천만건에 이르기 때문에 성능 이슈 해결이 가장 중요했습니다

- 500줄이 넘어가는 알고리즘에 중간 테이블 및 최종 결과 테이블을 구성하여 1차적으로 성능을 해결했습니다

- 중간 테이블 및 결과 테이블에 데이터를 insert하는 작업을 프로시저를 활용하여 일괄 처리했습니다.

- 작성된 프로시저에 일별 커서를 지정하고, Loop문을 생성하여 기존에 저장된 일자별 이력데이터 insert 작업을 진행했습니다.

- 이후 생성되는 최신 데이터는 작성된 프로시저를 DB 스케줄러에 등록하여 자동화 했습니다.

</div>
</details>

</br>

## 6. 그 외 트러블 슈팅
<details>
<summary>조건을 동적으로 지정하는 문제</summary>
<div markdown="1">

- MyBatis Dynamic SQL 활용
- if test 구문을 활용하여 필요한 경우에만 조건절을 삽입

</div>
</details>

